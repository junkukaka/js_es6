<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h2>ä¸€ä¸ªç½‘é¡µè°ƒç”¨å¤šä¸ªajaxè¯·æ±‚çš„æ—¶å€™ï¼Œç¡®ä¿è°ƒç”¨é¡ºåºï¼Œä¾‹å¦‚ç½‘é¡µåŠ è½½çš„æ—¶å€™ï¼Œajax02 æ ¹æ®ajax01çš„ç»“æœè°ƒç”¨ã€‚</h2>
    <p>å› ä¸ºajaxè¯·æ±‚æ˜¯ä¸ç¡®å®šè°ƒç”¨é¡ºåºçš„</p>
    <p>ä½¿ç”¨thenå®ç°promisse</p>

    <h2> Promise çŠ¶æ€</h2>
    <ul>
        <li>pendingï¼ˆè¿›è¡Œä¸­ï¼‰ï¼šåˆå§‹çŠ¶æ€ï¼Œæ—¢æ²¡æœ‰å®Œæˆä¹Ÿæ²¡æœ‰å¤±è´¥ã€‚</li>
        <li>fulfilledï¼ˆå·²å®Œæˆï¼‰ï¼šæ“ä½œæˆåŠŸï¼Œè°ƒç”¨ resolve()ï¼Œè¿›å…¥ .then()</li>
        <li>rejectedï¼ˆå·²æ‹’ç»ï¼‰ï¼šæ“ä½œå¤±è´¥ï¼Œè°ƒç”¨ reject()ï¼Œè¿›å…¥ .catch()</li>
    </ul>

    <h2>æ€»ç»“</h2>
    <ul>
        <li>Promise.all() :æ‰€æœ‰ Promise æˆåŠŸæ‰è¿”å›ï¼Œå¤±è´¥åˆ™ .catch()</li>
        <li>Promise.race(): ç¬¬ä¸€ä¸ª æˆåŠŸæˆ–å¤±è´¥çš„ Promise ç«‹å³è¿”å›</li>
        <li>Promise.allSettled() : æ— è®ºæˆåŠŸ/å¤±è´¥ï¼Œéƒ½è¿”å›æ‰€æœ‰ Promise ç»“æœ</li>
        <li>Promise.any(): ç¬¬ä¸€ä¸ªæˆåŠŸ çš„ Promise ç«‹å³è¿”å›ï¼Œæ‰€æœ‰å¤±è´¥åˆ™ .catch()</li>
        <li>sync/await : è®©å¼‚æ­¥ä»£ç æ›´åƒåŒæ­¥ä»£ç ï¼Œç®€æ´æ˜“è¯»</li>
    </ul>
    <script>
        //è¿”å›çš„æ˜¯Promise
        const usersPromise = axios.get('https://api.github.com/users');
        //console.log(users) 
        // usersPromise.then(response => console.log(response.data))
        
        let username;

        usersPromise.then(response => {
            username = response.data[0].login;
            return axios.get(`https://api.github.com/users/${username}/repos`)   
        }).then(response => {
            console.log(response)
        }).catch(err => {
            console.log(err)
        })
    </script>

    

    <script>

        // 1.Promise çš„åŸºæœ¬ç”¨æ³• 
        const myPromise = new Promise((resolve,reject) => {
            setTimeout(()=>{
                const success = true;
                if (success) {
                    resolve("success to action")
                }else{
                    reject("failure to action")
                }
            },2000)
        });
        // use my promise 
        myPromise.then(result => console.log(result)).catch(error => console.log(error));

        //2.Promise çŠ¶æ€
        const promise = new Promise((resolve, reject) => {
            setTimeout(() => resolve("ğŸ‰ æˆåŠŸï¼"), 1000);
        });

        console.log(promise); // pending
        setTimeout(() => console.log(promise), 2000); // fulfilled

        //3.é“¾å¼è°ƒç”¨ï¼ˆPromise Chainingï¼‰
        new Promise((resolve) => {
            resolve(1);
        })
        .then((num) => {
            console.log(num); // 1
            return num * 2;
        })
        .then((num) => {
            console.log(num); // 2
            return num * 3;
        })
        .then((num) => {
            console.log(num); // 6
        });

        //4.Promise.all() ï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰ åŒæ—¶æ‰§è¡Œå¤šä¸ª Promiseï¼Œæ‰€æœ‰éƒ½æˆåŠŸæ‰è¿›å…¥ .then()ï¼Œåªè¦æœ‰ä¸€ä¸ªå¤±è´¥å°±è¿›å…¥ .catch()ã€‚
        const p1 = new Promise(res => setTimeout(() => res("ğŸ"), 1000));
        const p2 = new Promise(res => setTimeout(() => res("ğŸŒ"), 2000));
        const p3 = new Promise(res => setTimeout(() => res("ğŸ‰"), 1500));

        Promise.all([p1, p2, p3])
        .then(results => console.log(results)) // [ 'ğŸ', 'ğŸŒ', 'ğŸ‰' ]
        .catch(error => console.error(error));

      

    </script>
    <script>
          //5.Promise.race()ï¼ˆç¬¬ä¸€ä¸ªå®Œæˆçš„ï¼‰ åªè¦æœ‰ä¸€ä¸ª Promise å®Œæˆï¼Œå°±ç›´æ¥è¿”å›å®ƒçš„ç»“æœã€‚
          Promise.race([
            new Promise(res => setTimeout(() => res("ğŸš€ 1 ç§’å®Œæˆ"), 1000)),
            new Promise(res => setTimeout(() => res("ğŸ¢ 2 ç§’å®Œæˆ"), 2000)),
        ])
        .then(result => console.log(result)) // ğŸš€ 1 ç§’å®Œæˆ
        .catch(error => console.error(error));

        //6.Promise.allSettled()ï¼ˆæ‰€æœ‰å®Œæˆï¼‰ æ— è®º Promise æ˜¯ fulfilled è¿˜æ˜¯ rejectedï¼Œéƒ½ä¼šè¿”å›æ‰€æœ‰ Promise çš„ç»“æœã€‚
        Promise.allSettled([
        Promise.resolve("âœ… æˆåŠŸ"),
        Promise.reject("âŒ å¤±è´¥"),
        new Promise(res => setTimeout(() => res("â³ 2 ç§’å®Œæˆ"), 2000))
        ])
        .then(results => console.log(results));

        //7. Promise.any()ï¼ˆç¬¬ä¸€ä¸ªæˆåŠŸçš„ï¼‰
        Promise.any([
        Promise.reject("âŒ å¤±è´¥ 1"),
        new Promise(res => setTimeout(() => res("ğŸ‰ ç¬¬ä¸€ä¸ªæˆåŠŸ"), 1000)),
        Promise.reject("âŒ å¤±è´¥ 2")
        ])
        .then(result => console.log(result)) // ğŸ‰ ç¬¬ä¸€ä¸ªæˆåŠŸ
        .catch(error => console.error(error));

    </script>

    <script>
        //async/await è¯­æ³•ç³–
        function delay(ms) {
            return new Promise(res => setTimeout(res, ms));
        }

        async function fetchData() {
            console.log("âŒ› åŠ è½½æ•°æ®...");
            await delay(2000);
            console.log("âœ… æ•°æ®åŠ è½½æˆåŠŸï¼");
        }
        fetchData();
    </script>
</body>
</html>